<!DOCTYPE html>
<html>
<head>
    <title>Telegram Login Diagnostic</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .box { background: #222; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .error { color: #f44; }
        .success { color: #4f4; }
        .warning { color: #ff4; }
        code { background: #333; padding: 2px 6px; border-radius: 3px; }
        h1 { color: #fff; }
        h2 { color: #aaa; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        td { padding: 8px; border-bottom: 1px solid #444; }
        td:first-child { color: #888; width: 200px; }
    </style>
</head>
<body>
    <h1>üîç Telegram Login Diagnostic</h1>
    
    <div class="box">
        <h2>Bot Configuration</h2>
        <table>
            <tr><td>Bot Username:</td><td><code>{{ bot_username or 'NOT SET' }}</code></td></tr>
            <tr><td>Bot Token Set:</td><td>{% if has_token %}<span class="success">‚úÖ Yes</span>{% else %}<span class="error">‚ùå No</span>{% endif %}</td></tr>
            <tr><td>Expected Domain:</td><td><code>{{ request.host }}</code></td></tr>
            <tr><td>App URL Config:</td><td><code>{{ app_url }}</code></td></tr>
            <tr><td>Auth Callback URL:</td><td><code>{{ auth_url }}</code></td></tr>
        </table>
    </div>

    <div class="box">
        <h2>Widget Configuration</h2>
        <p>The widget below is configured with these exact parameters:</p>
        <pre style="background: #333; padding: 10px; overflow-x: auto;">
data-telegram-login="{{ bot_username }}"
data-auth-url="{{ auth_url }}"
data-request-access="write"</pre>
        
        {% if bot_username and bot_username != 'your_bot_username' %}
        <div style="margin: 20px 0; padding: 20px; background: #333; text-align: center;">
            <script async src="https://telegram.org/js/telegram-widget.js?22" 
                data-telegram-login="{{ bot_username }}" 
                data-size="large" 
                data-auth-url="{{ auth_url }}"
                data-request-access="write"
                data-userpic="false">
            </script>
        </div>
        {% endif %}
    </div>

    <div class="box">
        <h2>BotFather Instructions</h2>
        <p class="warning">You MUST set the domain EXACTLY as shown below:</p>
        <ol>
            <li>Message <a href="https://t.me/BotFather" target="_blank" style="color: #4af;">@BotFather</a></li>
            <li>Send: <code>/setdomain</code></li>
            <li>Select your bot: <code>@{{ bot_username }}</code></li>
            <li>Enter EXACTLY this text (copy & paste):</li>
        </ol>
        <div style="background: #000; padding: 15px; margin: 10px 0; border: 2px solid #ff4;">
            <code style="font-size: 18px;">{{ request.host }}</code>
        </div>
        <p class="error">‚ö†Ô∏è DO NOT include https:// or www.</p>
        <p class="error">‚ö†Ô∏è DO NOT add a trailing slash</p>
        <p class="error">‚ö†Ô∏è Copy the green text above EXACTLY</p>
    </div>

    <div class="box">
        <h2>Common Mistakes</h2>
        <table>
            <tr>
                <td>‚ùå Wrong:</td>
                <td><code>https://cardcreator.havliksimon.eu</code></td>
            </tr>
            <tr>
                <td>‚ùå Wrong:</td>
                <td><code>https://cardcreator.havliksimon.eu/</code></td>
            </tr>
            <tr>
                <td>‚ùå Wrong:</td>
                <td><code>www.cardcreator.havliksimon.eu</code></td>
            </tr>
            <tr>
                <td>‚úÖ Correct:</td>
                <td><code style="color: #4f4;">cardcreator.havliksimon.eu</code></td>
            </tr>
        </table>
    </div>

    <div class="box">
        <h2>Request Headers</h2>
        <table>
            <tr><td>Host:</td><td><code>{{ request.host }}</code></td></tr>
            <tr><td>Scheme:</td><td><code>{{ request.scheme }}</code></td></tr>
            <tr><td>URL:</td><td><code>{{ request.url }}</code></td></tr>
            <tr><td>Origin Header:</td><td><code>{{ request.headers.get('Origin', 'Not set') }}</code></td></tr>
            <tr><td>Referer:</td><td><code>{{ request.headers.get('Referer', 'Not set') }}</code></td></tr>
        </table>
    </div>

    <p><a href="{{ url_for('main.index') }}" style="color: #4af;">‚Üê Back to Home</a></p>
</body>
</html>
